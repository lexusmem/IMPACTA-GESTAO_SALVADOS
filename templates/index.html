{% extends "base.html" %}
{% block content %}

<!-- Container para bot√£o lista de salvados -->
<div class="container mt-4 d-flex justify-content-between align-items-center">
    <h2 class="mb-0">Lista de Salvados</h2>
    <button type="button" id="btnExportar" class="btn btn-success">
        üì• Exportar Salvados
    </button>
</div>

<!-- Script para exportar salvados -->
<script>
    document.getElementById('btnExportar').addEventListener('click', function () {
        // Pega os par√¢metros do formul√°rio
        const params = new URLSearchParams(new FormData(document.querySelector('form')));
        window.location.href = "{{ url_for('exportar_salvados') }}?" + params.toString();
    });
</script>

<!-- Container para alerta -->
<div id="alerta-salvados" class="container mt-4" style="display:none;">
    <div class="alert alert-warning text-center" role="alert">
        <strong>N√£o existem salvados cadastrados.</strong>
    </div>
</div>


<!-- Container para filtros -->
<div class="table-responsive  container mt-4">
    <form class="row g-3">
        <div class="col-md-3">
            <label for="inputSinistro" class="form-label">Sinistro</label>
            <input type="number" class="form-control" id="inputSinistro" name="sinistro" placeholder=""
                value="{{ request.args.get('sinistro', '') }}">
        </div>
        <div class="col-md-3">
            <label for="inputPlaca" class="form-label">Placa</label>
            <input type="text" class="form-control" id="inputPlaca" name="placa" placeholder=""
                value="{{ request.args.get('placa', '') }}">
        </div>
        <div class="col-md-3">
            <label for="inputApolice" class="form-label">Ap√≥lice</label>
            <input type="number" class="form-control" id="inputApolice" name="apolice" placeholder=""
                value="{{ request.args.get('apolice', '') }}">
        </div>
        <!-- Segunda Linha -->
        <div class="col-md-3">
            <label for="inputSegurado" class="form-label">Segurado</label>
            <input type="text" class="form-control" id="inputSegurado" name="segurado" placeholder=""
                value="{{ request.args.get('segurado', '') }}">
        </div>

        <div class="col-md-3">
            <label for="inputAnalista" class="form-label">Analista</label>
            <select id="inputAnalista" class="form-select" name="analista">
                <!-- <option selected value="">Selecione</option> -->
                <option value="">Selecione</option>
                {% for analista in analistas_opcoes %}
                <option value="{{ analista }}" {% if request.args.get('analista')==analista %}selected{% endif %}>{{
                    analista }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="col-md-3">
            <label for="inputLeiloeiro" class="form-label">Leiloeiro</label>
            <select class="form-select" name="leiloeiro" id="inputLeiloeiro">
                <option value="">Selecione</option>
                {% for leiloeiro in leiloeiros_opcoes %}
                <option value="{{ leiloeiro }}" {% if request.args.get('leiloeiro')==leiloeiro %}selected{% endif %}>{{
                    leiloeiro }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="col-md-3">
            <label for="inputStatus" class="form-label">Status</label>
            <select id="inputStatus" class="form-select" name="status">
                <option value="">Selecione</option>
                {% for status in status_opcoes %}
                <option value="{{ status }}" {% if request.args.get('status')==status %}selected{% endif %}>{{
                    status }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="col-md-3">
            <label for="inputTerceiro" class="form-label">Terceiro</label>
            <input type="text" class="form-control" id="inputTerceiro" name="terceiro" placeholder=""
                value="{{ request.args.get('terceiro', '') }}">
        </div>

        <!-- Div para os bot√µes -->
        <div class="col-12 mt-4">
            <!-- Bot√£o de Submit Filtrar -->
            <button type="submit" class="btn btn-primary">Filtrar</button>
            <!-- Bot√£o de Submit Limpar -->
            <button type="button" class="btn btn-secondary"
                onclick="window.location.href='{{ url_for('index') }}'">Limpar Filtros</button>
        </div>
    </form>
</div>
<!-- Fim Container para filtros -->

<!-- Container para tabela -->
<div class="table-responsive  container mt-5">
    <table class="table table-striped table-hover">
        <thead class="table-dark">
            <tr>
                <th>ID</th>
                <th>Sinistro</th>
                <th>Placa</th>
                <th>Analista</th>
                <th>Data Recebimento</th>
                <th>Status Salvado</th>
                <th>A√ß√£o</th>
            </tr>
        </thead>
        <tbody>
            {% for salvado in salvados %}
            <tr style="cursor: pointer;" onclick="window.location='{{ url_for('detalhes', id=salvado.id) }}';">
                <td>{{ salvado.id }}</td>
                <td>{{ salvado.sinistro }}</td>
                <td>{{ salvado.placa }}</td>
                <td>{{ salvado.analista_responsavel }}</td>
                <td>{{ salvado.data_recebimento_salvado|default('')|strftime('%d/%m/%Y') }}</td>
                <td>
                    <span
                        class="badge bg-{{ 'success' if salvado.status == 'Finalizado' else 'danger' if salvado.status == 'Cancelado' else 'primary' }}">{{
                        salvado.status }}</span>
                </td>
                <td>
                    <a href="{{ url_for('atualizar', id=salvado.id) }}" class="btn btn-sm btn-outline-primary"
                        onclick="event.stopPropagation();">Atualizar</a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

{% endblock %}