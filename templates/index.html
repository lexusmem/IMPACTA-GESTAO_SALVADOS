{% extends "base.html" %}
{% block content %}

<!-- Container para botÃ£o lista de salvados -->
<div class="container mt-4 d-flex justify-content-between align-items-center">
    <h2 class="mb-0">Lista de Salvados</h2>
    <button id="btnExportar" class="btn btn-success">
        ðŸ“¥ Exportar Salvados
    </button>
</div>

<!-- Container para alerta -->
<div id="alerta-salvados" class="container mt-4" style="display:none;">
    <div class="alert alert-warning text-center" role="alert">
        <strong>NÃ£o existem salvados cadastrados.</strong>
    </div>
</div>

<!-- Script para exportar salvados -->
<script>
    document.getElementById('btnExportar').addEventListener('click', function () {
        var salvadosCount = {{ salvados| length
    }};
    if (salvadosCount === 0) {
        document.getElementById('alerta-salvados').style.display = 'block';
    } else {
        window.location.href = "{{ url_for('exportar_salvados') }}";
    }
});
</script>

<!-- Container para filtros 2 -->
<div class="table-responsive  container mt-4">
    <form class="row g-3">
        <div class="col-md-3">
            <label for="inputSinistro" class="form-label">Sinistro</label>
            <input type="number" class="form-control" id="inputSinistro" name="sinistro" placeholder="">
        </div>
        <div class="col-md-3">
            <label for="inputPlaca" class="form-label">Placa</label>
            <input type="text" class="form-control" id="inputPlaca" name="placa" placeholder="">
        </div>
        <div class="col-md-3">
            <label for="inputApolice" class="form-label">ApÃ³lice</label>
            <input type="number" class="form-control" id="inputApolice" name="apolice" placeholder="">
        </div>
        <!-- Segunda Linha -->
        <div class="col-md-3">
            <label for="inputSegurado" class="form-label">Segurado</label>
            <input type="text" class="form-control" id="inputSegurado" name="segurado" placeholder="">
        </div>

        <div class="col-md-3">
            <label for="inputAnalista" class="form-label">Analista</label>
            <select id="inputAnalista" class="form-select" name="analista">
                <option selected value="">Selecione</option>
                {% for analista in analistas_opcoes %}
                <option value="{{ analista }}">{{ analista }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="col-md-3">
            <label for="inputLeiloeiro" class="form-label">Leiloeiro</label>
            <select class="form-select" name="leiloeiro" id="inputLeiloeiro">
                <option selected value="">Selecione</option>
                {% for leiloeiro in leiloeiros_opcoes %}
                <option value="{{ leiloeiro }}">{{ leiloeiro }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="col-md-3">
            <label for="inputStatus" class="form-label">Status</label>
            <select id="inputStatus" class="form-select" name="status">
                <option selected value="">Selecione</option>
                {% for status in status_opcoes %}
                <option value="{{ status }}">{{ status }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="col-md-3">
            <label for="inputTerceiro" class="form-label">Terceiro</label>
            <input type="text" class="form-control" id="inputTerceiro" name="terceiro" placeholder="">
        </div>

        <!-- Div para os botÃµes -->
        <div class="col-12 mt-4">
            <!-- BotÃ£o de Submit Filtrar -->
            <button type="submit" class="btn btn-primary">Filtrar</button>
            <!-- BotÃ£o de Submit Limpar -->
            <button type="reset" class="btn btn-secondary">Limpar Filtros</button>
        </div>
    </form>
</div>

<!-- Fim Container para filtros 2 -->


<!-- Container para tabela -->
<div class="table-responsive  container mt-5">
    <table class="table table-striped table-hover">
        <thead class="table-dark">
            <tr>
                <th>ID</th>
                <th>Sinistro</th>
                <th>Placa</th>
                <th>Analista</th>
                <th>Data Salvado</th>
                <th>AÃ§Ãµes</th>
                <th>Status</th>
            </tr>
        </thead>
        <tbody>
            {% for salvado in salvados %}
            <tr style="cursor: pointer;" onclick="window.location='{{ url_for('detalhes', id=salvado.id) }}';">
                <td>{{ salvado.id }}</td>
                <td>{{ salvado.sinistro }}</td>
                <td>{{ salvado.placa }}</td>
                <td>{{ salvado.analista_responsavel }}</td>
                <td>{{ salvado.data_recebimento_salvado|strftime('%d/%m/%Y') }}</td>
                <td>
                    <span
                        class="badge bg-{{ 'success' if salvado.status == 'Finalizado' else 'danger' if salvado.status == 'Cancelado' else 'primary' }}">{{
                        salvado.status }}</span>
                </td>
                <td>
                    <a href="{{ url_for('atualizar', id=salvado.id) }}" class="btn btn-sm btn-outline-primary"
                        onclick="event.stopPropagation();">Atualizar</a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

{% endblock %}