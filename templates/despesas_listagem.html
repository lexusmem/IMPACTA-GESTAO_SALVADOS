{% extends "base.html" %}
{% block content %}

<!-- Modal de alerta -->
{% if erro_modal %}
<div id="modal-alerta" class="modal">
    <div class="modal-content">
        <h3 style="margin-top:0;">Aten칞칚o</h3>
        <p>{{ erro_modal }}</p>
        <button class="btn-modal-ok" onclick="document.getElementById('modal-alerta').style.display='none'">OK</button>
    </div>
</div>
{% endif %}

<!-- Container para bot칚o lista de despesas -->
<div class="container mt-4 d-flex justify-content-between align-items-center">
    <h2 class="mb-0">Despesas</h2>
    <button type="button" id="btnExportar" class="btn btn-success">
        游닌 Exportar Despesas
    </button>
</div>

<!-- Script para exportar despesas -->
<script>
    document.getElementById('btnExportar').addEventListener('click', function () {
        // Pega os par칙metros do formul치rio
        const params = new URLSearchParams(new FormData(document.querySelector('form')));
        window.location.href = "{{ url_for('exportar_despesas') }}?" + params.toString();
    });
</script>


<!-- Titulo da P치gina -->
<h2 class="mb-0 container mt-4">Lista de Despesas</h2>

<!-- Formul치rio para busca de despesas -->
<form method="POST" class="mb-4">
    <div class="card p-4 shadow-sm container mt-4">
        <div class="row mb-2">
            <h4 class="col-md-12">Pesquisa</h4>
        </div>
        <div class="row">
            <div class="col-md-3">
                <label class="form-label">N춿 Sinistro</label>
                <input type="number" class="form-control" name="sinistro" placeholder=""
                    value="{{ request.form.get('sinistro', '') }}">
            </div>
            <div class="col-md-3">
                <label class="form-label">Placa</label>
                <input type="text" class="form-control" name="placa" placeholder=""
                    value="{{ request.form.get('placa', '') }}">
            </div>
            <div class="col-md-3">
                <label class="form-label">Fornecedor</label>
                <input type="text" class="form-control" name="fornecedor" placeholder=""
                    value="{{ request.form.get('fornecedor', '') }}">
            </div>
            <div class="col-md-3">
                <label class="form-label">Tipo de Despesa</label>
                <input type="text" class="form-control" name="ocorrencia" placeholder=""
                    value="{{ request.form.get('ocorrencia', '') }}">
            </div>
        </div>
        <div class="col-12 mt-4">

            <!-- Bot칚o de Submit Filtrar -->
            <button type="submit" class="btn btn-primary">Filtrar</button>
            <!-- Bot칚o de Submit Limpar -->
            <button type="button" class="btn btn-secondary"
                onclick="window.location.href='{{ url_for('despesas_listagem') }}'">Limpar Filtros</button>

        </div>
    </div>
</form>

<!-- Lista de despesas -->
{% if despesas and despesas|length > 0 %}
<div class="table-responsive container mt-3">
    <table class="table table-striped table-hover">
        <thead class="table-dark">
            <tr>
                <th>N춿 Sinistro</th>
                <th>Placa</th>
                <th>Fornecedor</th>
                <th>Tipo de Despesa</th>
                <th>Valor (R$)</th>
                <th>Data</th>
                <th>Informa칞칫es Adicionais</th>
            </tr>
        </thead>
        <tbody>
            {% for despesa in despesas %}
            <tr>
                <td>{{ despesa.salvado.sinistro }}</td>
                <td>{{ despesa.salvado.placa }}</td>
                <td>{{ despesa.fornecedor }}</td>
                <td>{{ despesa.ocorrencia }}</td>
                <td>{{ despesa.valor|currency }}</td>
                <td>{{ despesa.data|strftime('%d/%m/%Y') }}</td>
                <td>{{ despesa.observacao }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endif %}


{% endblock %}